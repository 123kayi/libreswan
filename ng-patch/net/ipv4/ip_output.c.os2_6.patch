*** net/ipv4/ip_output.c.orig	2008-03-27 21:18:23.000000000 -0400
--- net/ipv4/ip_output.c	2006-04-25 22:40:09.000000000 -0400
***************
*** 392,397 ****
--- 392,399 ----
  	/* Copy the flags to each fragment. */
  	IPCB(to)->flags = IPCB(from)->flags;
  
+ 	to->sp = secpath_get(from->sp);
+ 
  #ifdef CONFIG_NET_SCHED
  	to->tc_index = from->tc_index;
  #endif
***************
*** 930,935 ****
--- 932,938 ----
  			 */
  			skb->ip_summed = csummode;
  			skb->csum = 0;
+ 			skb->sp = secpath_get(ipc->sp);
  			skb_reserve(skb, hh_len);
  
  			/*
***************
*** 1340,1345 ****
--- 1343,1350 ----
  	u32 daddr;
  	struct rtable *rt = (struct rtable*)skb->dst;
  
+ 	memset(&ipc, 0, sizeof(ipc));
+ 
  	if (ip_options_echo(&replyopts.opt, skb))
  		return;
  
