<refsect2 id='conn_parameters__general'><title>CONN PARAMETERS:  GENERAL</title>
<para>The following parameters are relevant to both automatic and manual keying.
Unless otherwise noted,
for a connection to work,
in general it is necessary for the two ends to agree exactly
on the values of these parameters.</para>
<variablelist remap='TP'>
  <varlistentry>
  <term><emphasis remap='B'>type</emphasis></term>
  <listitem>
<para>the type of the connection; currently the accepted values
are
<emphasis remap='B'>tunnel</emphasis>
(the default)
signifying a host-to-host, host-to-subnet, or subnet-to-subnet tunnel;
<emphasis remap='B'>transport</emphasis>,
signifying host-to-host transport mode;
<emphasis remap='B'>passthrough</emphasis>,
signifying that no IPsec processing should be done at all;
<emphasis remap='B'>drop</emphasis>,
signifying that packets should be discarded; and
<emphasis remap='B'>reject</emphasis>,
signifying that packets should be discarded and a diagnostic ICMP returned.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>left</emphasis></term>
  <listitem>
<para>(required)
the IP address of the left participant's public-network interface,
in any form accepted by
<citerefentry><refentrytitle>ipsec_ttoaddr</refentrytitle><manvolnum>3</manvolnum></citerefentry>
or one of several magic values.
If it is
<emphasis remap='B'>%defaultroute</emphasis>,
and
the
<emphasis remap='B'>config</emphasis>
<emphasis remap='B'>setup</emphasis>
section's,
<emphasis remap='B'>interfaces</emphasis>
specification contains
<emphasis remap='B'>%defaultroute,</emphasis>
<emphasis remap='B'>left</emphasis>
will be filled in automatically with the local address
of the default-route interface (as determined at IPsec startup time);
this also overrides any value supplied for
<emphasis remap='B'>leftnexthop</emphasis>.
(Either
<emphasis remap='B'>left</emphasis>
or
<emphasis remap='B'>right</emphasis>
may be
<emphasis remap='B'>%defaultroute</emphasis>,
but not both.)
The value
<emphasis remap='B'>%any</emphasis>
signifies an address to be filled in (by automatic keying) during
negotiation.
The value
<emphasis remap='B'>%opportunistic</emphasis>
signifies that both
<emphasis remap='B'>left</emphasis>
and
<emphasis remap='B'>leftnexthop</emphasis>
are to be filled in (by automatic keying) from DNS data for
<emphasis remap='B'>left</emphasis>'s
client.
The values
<emphasis remap='B'>%group</emphasis>
and
<emphasis remap='B'>%opportunisticgroup</emphasis>
makes this a policy group conn: one that will be instantiated
into a regular or opportunistic conn for each CIDR block listed in the
policy group file with the same name as the conn.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>leftsubnet</emphasis></term>
  <listitem>
<para>private subnet behind the left participant, expressed as
<emphasis remap='I'>network</emphasis><emphasis remap='B'>/</emphasis><emphasis remap='I'>netmask</emphasis>
(actually, any form acceptable to
<citerefentry><refentrytitle>ipsec_ttosubnet</refentrytitle><manvolnum>3</manvolnum></citerefentry>);
if omitted, essentially assumed to be <emphasis remap='I'>left</emphasis><filename>/32</filename>,
signifying that the left end of the connection goes to the left participant only</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>leftnexthop</emphasis></term>
  <listitem>
<para>next-hop gateway IP address for the left participant's connection
to the public network;
defaults to
<emphasis remap='B'>%direct</emphasis>
(meaning
<emphasis remap='I'>right</emphasis>).
If the value is to be overridden by the
<emphasis remap='B'>left=%defaultroute</emphasis>
method (see above),
an explicit value must
<emphasis remap='I'>not</emphasis>
be given.
If that method is not being used,
but
<emphasis remap='B'>leftnexthop</emphasis>
is
<emphasis remap='B'>%defaultroute</emphasis>,
and
<emphasis remap='B'>interfaces=%defaultroute</emphasis>
is used in the
<emphasis remap='B'>config</emphasis>
<emphasis remap='B'>setup</emphasis>
section,
the next-hop gateway address of the default-route interface
will be used.
The magic value
<emphasis remap='B'>%direct</emphasis>
signifies a value to be filled in (by automatic keying)
with the peer's address.
Relevant only locally, other end need not agree on it.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>leftupdown</emphasis></term>
  <listitem>
<para>what &ldquo;updown&rdquo; script to run to adjust routing and/or firewalling
when the status of the connection
changes (default
<emphasis remap='B'>ipsec _updown</emphasis>).
May include positional parameters separated by white space
(although this requires enclosing the whole string in quotes);
including shell metacharacters is unwise.
See
<citerefentry><refentrytitle>ipsec_pluto</refentrytitle><manvolnum>8</manvolnum></citerefentry>
for details.
Relevant only locally, other end need not agree on it.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>leftfirewall</emphasis></term>
  <listitem>
<para>whether the left participant is doing forwarding-firewalling
(including masquerading) for traffic from <emphasis remap='I'>leftsubnet</emphasis>,
which should be turned off (for traffic to the other subnet)
once the connection is established;
acceptable values are
<emphasis remap='B'>yes</emphasis>
and (the default)
<emphasis remap='B'>no</emphasis>.
May not be used in the same connection description with
<emphasis remap='B'>leftupdown</emphasis>.
Implemented as a parameter to the default
<emphasis remap='I'>updown</emphasis>
script.
See notes below.
Relevant only locally, other end need not agree on it.</para>
  </listitem>
  </varlistentry>
</variablelist>

<para>If one or both security gateways are doing forwarding firewalling
(possibly including masquerading),
and this is specified using the firewall parameters,
tunnels established with IPsec are exempted from it
so that packets can flow unchanged through the tunnels.
(This means that all subnets connected in this manner must have
distinct, non-overlapping subnet address blocks.)
This is done by the default
<emphasis remap='I'>updown</emphasis>
script (see
<citerefentry><refentrytitle>ipsec_pluto</refentrytitle><manvolnum>8</manvolnum></citerefentry>).</para>

<para>The implementation of this makes certain assumptions about firewall setup,
notably the use of the old
<emphasis remap='I'>ipfwadm</emphasis>
interface to the firewall.
In situations calling for more control,
it may be preferable for the user to supply his own
<emphasis remap='I'>updown</emphasis>
script,
which makes the appropriate adjustments for his system.</para>
</refsect2>

