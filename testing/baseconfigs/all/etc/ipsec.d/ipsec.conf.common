# common pieces for ipsec.conf. No host addresses.
#
# for conns
# left  = WEST
# right = EAST
#
# for OE stuff,
# right = my stuff
# left  = other stuff.
#

conn us-to-anyone
	also=us
	also=me-to-anyone

conn me-to-anyone
	right=%defaultroute
	rightnexthop=%defaultroute
	left=%opportunistic
	failureshunt=drop
	# uncomment to enable incoming; change to auto=route for outgoing
	#auto=add

# food groups: clear, clear-or-private, private-or-clear, private, block
# Tempting to use "postcard" instead of "clear"
# these are for a subnet behind us.
conn us-clear
	also=clear
	also=us

conn us-let-my-dns-go
	also=let-my-dns-go

# except the connection to the DNS server
conn let-my-dns-go
        left=%defaultroute
        leftprotoport=17/%any
        right=0.0.0.0
        rightsubnet=0.0.0.0/0
        rightprotoport=17/53
        type=passthrough
        auto=ignore

conn us-clear-or-private
	also=clear-or-private
	also=us

conn us-private-or-clear
	also=private-or-clear
	also=us

conn us-private-or-clear-all
	also=private-or-clear
	also=us

conn us-private
	also=private
	also=us

conn us-block
	also=block
	also=us

# a different named conn, so we can have a different policy
conn private-or-clear-all
	also=private-or-clear

# these are for self
conn clear
	type=passthrough
	authby=never
	right=%defaultroute
	left=%group
	#auto=route

conn clear-or-private
	type=passthrough
	right=%defaultroute
	left=%opportunisticgroup
	# by using "add", we get passive.
	# but this does not actually implement "clear" :-(
	failureshunt=passthrough
	#auto=route

conn private-or-clear
	type=tunnel
	right=%defaultroute
	left=%opportunisticgroup
	failureshunt=passthrough
	#auto=route

conn private
	type=tunnel
	right=%defaultroute
	left=%opportunisticgroup
	# without failureshunt, renegotiation will be tried.
	failureshunt=drop
	#auto=route

conn block
	type=reject
	authby=never
	right=%defaultroute
	left=%group
	#auto=route

# VPN connection
conn west-east
	also=west-east-base-id-nss
	also=west-east-base-ipv4
	#auto=start

conn west-eastnet
	also=west-east-base-id-nss
	also=west-east-base-ipv4
	also=eastnet-ipv4
	#auto=start

conn westnet-east
	also=west-east-base-id-nss
	also=west-east-base-ipv4
	also=westnet-ipv4
	#auto=start

conn west-east-pass
	also=west-east-base-id-nss
	also=west-east-base-ipv4
	type=passthrough
	#auto=start

conn westnet-east-pass
	also=west-east-base-id-nss
	also=west-east-base-ipv4
	also=westnet-ipv4
	type=passthrough
	#auto=start

conn west-eastnet-pass
	also=west-east-base-id-nss
	also=west-east-base-ipv4
	also=eastnet-ipv4
	type=passthrough
	#auto=start

conn westnet-eastnet-ipcomp
	compress=yes
	also=westnet-eastnet

conn westnet-eastnet-sourceip
	leftsourceip=192.0.1.254
	also=westnet-eastnet

# also processing split in two parts messes up with connaddrfamily checking
# rewrite this now as work around as to not break ALL test cases :)
#conn westnet-eastnet-6in4
#   also=west-east-base-ipv4
#   also=westnet-eastnet-ipv6

conn westnet-eastnet-6in4
	also=west-east-base-id-nss
	left=192.1.2.45
	#leftnexthop=192.1.2.23
	right=192.1.2.23
	#rightnexthop=192.1.2.45
        leftsubnet=2001:db8:0:1::/64
        rightsubnet=2001:db8:0:2::/64
        connaddrfamily=ipv6

# Same issue for this conn
#conn westnet-eastnet-4in6
#	also=west-east-base-id-nss
#	also=west-east-base-ipv6
#	#connaddrfamily=ipv6
#	also=westnet-ipv4
#	also=eastnet-ipv4
#	auto=ignore

conn westnet-eastnet-4in6
	also=west-east-base-id-nss
	#also=west-east-base-ipv6
	left=2001:db8:1:2::45
	#leftnexthop=2001:db8:1:2::23
	right=2001:db8:1:2::23
	#rightnexthop=2001:db8:1:2::45
	#connaddrfamily=ipv6
	leftsubnet=192.0.1.0/24
	rightsubnet=192.0.2.0/24
	auto=ignore

# and this one
conn westnet-eastnet-6in6
	also=west-east-base-id-nss
	#also=west-east-base-ipv6
	left=2001:db8:1:2::45
	leftnexthop=2001:db8:1:2::23
	right=2001:db8:1:2::23
	rightnexthop=2001:db8:1:2::45
	also=westnet-eastnet-ipv6

# alias for the testcases
conn westnet-eastnet
	also=westnet-eastnet-ipv4

conn westnet-eastnet-ipv4-psk
	also=west-east-base-id-psk
	also=west-east-base-ipv4
	also=westnet-ipv4
	also=eastnet-ipv4
	
conn westnet-eastnet-ipv4
	also=west-east-base-id-nss
	also=west-east-base-ipv4
	also=westnet-ipv4
	also=eastnet-ipv4

# this has no base because it is included with a base of 6 or 4
conn westnet-eastnet-ipv6
	leftsubnet=2001:db8:0:1::/64
	rightsubnet=2001:db8:0:2::/64
	connaddrfamily=ipv6
	#auto=start

conn westnet-eastnet-pass
	also=west-east-base-id-nss
	also=west-east-base-ipv4
	also=westnet-ipv4
	also=eastnet-ipv4
	type=passthrough
	#auto=start

conn westnet-eastnet-drop
	also=west-east-base-id-nss
	also=west-east-base-ipv4
	also=westnet-ipv4
	also=eastnet-ipv4
	type=drop
	#auto=start

conn westnet-eastnet-x509
	also=westnet
	leftsourceip=192.0.1.254
	also=eastnet
	rightsourceip=192.0.2.254
	also=west-east-x509

# aliases for old test cases - ideally testcases stop using these two names
conn eastnet
	also=eastnet-ipv4

conn westnet
	also=westnet-ipv4

conn eastnet-ipv4
	rightsubnet=192.0.2.0/24

conn westnet-ipv4
	leftsubnet=192.0.1.0/24

conn west-east-base
	also=west-east-base-ipv4
	also=west-east-base-id-nss

conn west-east-base-ipv4
	left=192.1.2.45
	leftnexthop=192.1.2.23
	right=192.1.2.23
	rightnexthop=192.1.2.45

conn west-east-base-ipv6
	connaddrfamily=ipv6
	left=2001:db8:1:2::45
	leftnexthop=2001:db8:1:2::23
	right=2001:db8:1:2::23
	rightnexthop=2001:db8:1:2::45

conn west-east-base-id-psk
	leftid=@west
	rightid=@east
	authby=secret
	
conn west-east-base-id-rsa
	# Left security gateway, subnet behind it, next hop toward right.
	leftid=@west
        leftrsasigkey=0sAQPgqN1V7e8UmL7hQQx+STfD5WQl7UQmvNMwxTPXhnnoCXY4orSRwAXBdFgtXol4g+L0vN0t2bW8jxkqSBZK2jjtGuVZIVVUaqVKVn3mziRoUaY3Ol5mXCMEaRR01v7tE0Y2aY1EXg/gHdN6O/VqLT5k9Wo2Un1gDxWt5s4Pxq55ZyAc6+WGIwaXWusTdA6lcUVYfgxvDoXRREmCLS0g6kqeV4tBc3WKavjSrj4CRm3gjxbjbQqenkfzNl5cEUey4VzSW2eEwb1UBYH53PtC+bg5ltWeyZHj7beLYFQeMVnbOxBMg1+SLwYul4Lcf8LK2u+609pqs9h97Ktpr0G7AA8L8xa2shJuYI918SoIRa0z8nQH
	# Right security gateway, subnet behind it, next hop toward left.
	rightid=@east
        rightrsasigkey=0sAQPHTiDA1kGw6ENPkwo2ivTZq3OmSVurjVkLkhKwVJ4pwA1DrK7zMvyvAza6WnRP6TYURI2W3KoSQVg65LbXGigLXeixOLmXepHRd/3ILbanoeKB0sw64Bq7Zv0rm2NS/AHiD7NlXqmvjCpwo/3fiVR+pHYBIrqD3sVoZYQ95yER2Q0WAyjTugeWg8SBkMFz3sBFuNbtFxaFtVf6kenYE2fP6ByQSXPKt0mJFx/tlpCdTudipJMIsk8WxMpd0GTydw5RBVtP0Kfp41wiUrEAgKo4Eu8VOtXkWfdtujSRc+Jm/92ctbEylUlTrinC+QQDohKEqGvOhs9L+LnQNYnDdqsx+y+PddmpEEfQybY0T8c+ogSL

conn road-east-base
	right=192.1.2.23
	rightid=@east
	rightrsasigkey=0sAQPHTiDA1kGw6ENPkwo2ivTZq3OmSVurjVkLkhKwVJ4pwA1DrK7zMvyvAza6WnRP6TYURI2W3KoSQVg65LbXGigLXeixOLmXepHRd/3ILbanoeKB0sw64Bq7Zv0rm2NS/AHiD7NlXqmvjCpwo/3fiVR+pHYBIrqD3sVoZYQ95yER2Q0WAyjTugeWg8SBkMFz3sBFuNbtFxaFtVf6kenYE2fP6ByQSXPKt0mJFx/tlpCdTudipJMIsk8WxMpd0GTydw5RBVtP0Kfp41wiUrEAgKo4Eu8VOtXkWfdtujSRc+Jm/92ctbEylUlTrinC+QQDohKEqGvOhs9L+LnQNYnDdqsx+y+PddmpEEfQybY0T8c+ogSL
	rightnexthop=192.1.2.45
	leftid=@road.testing.xelerance.com
        leftrsasigkey=0sAQNxbOBmDqiNrUmn5q4kzBQ6I6pW/g2c8iDh3Y/KDtELBC6G0dASaaa95lV0cZT2kla681hVLzRF4MUCmFkH5ih514Nrwc5aptte49/70WotqcbvAhXeBX0zbg78gUPaT7CcUEAYxHoqHubao4mmfWlSrOnpf4crE/q3J6zH+8Z3bfsTGnpThgfNCItHpH7jkHPUYDilHsk0Zfd5fxjVDbl8JbQoT3P1KrdmpK7M1sXQhug12ocq8HlrXa3smJIq5b4T0rF+MYrThrNytNIEn53phuj6S8qmONin4usCqpUw50i2VqaBNQSY++/B57AqThFZNqt7TjqqT0CQ7tPRELgXwRvWA04GDhqBHHWoOrLdsR0p

conn west-east-x509
        # Left security gateway, subnet behind it, next hop toward right.
        left=192.1.2.45
        leftrsasigkey=%cert
        leftcert=west.crt
        leftnexthop=192.1.2.23
        leftid="C=ca, ST=Ontario, O=Xelerance, OU=Test Department, CN=west.testing.xelerance.com, E=testing@xelerance.com"
        # Right security gateway, subnet behind it, next hop toward left.
        right=192.1.2.23
        rightid="C=ca, ST=Ontario, O=Xelerance, OU=Test Department, CN=east.testing.xelerance.com, E=testing@xelerance.com"
        rightrsasigkey=%cert
        rightcert=east.crt
        rightnexthop=192.1.2.45

conn north-east-x509
	# Left security gateway, subnet behind it, next hop toward right.
	left=192.1.2.49
        leftrsasigkey=%cert
        leftcert=north.crt  
	leftnexthop=192.1.2.23
	leftid="C=ca, ST=Ontario, O=Xelerance, OU=Test Department, CN=north.testing.xelerance.com, E=testing@xelerance.com"
	# Right security gateway, subnet behind it, next hop toward left.
	right=192.1.2.23
	rightid="C=ca, ST=Ontario, O=Xelerance, OU=Test Department, CN=east.testing.xelerance.com, E=testing@xelerance.com"
        rightrsasigkey=%cert
	rightcert=east.crt
	rightnexthop=192.1.2.49

conn north-east
	# Left security gateway, subnet behind it, next hop toward right.
	left=%any
	leftnexthop=192.2.3.254
	leftid=@north
        leftrsasigkey=0sAQPwDB+4k65xvxQ3qtPV6rUucJovYeRGnfv6T7HaeK/5TcBXDyhEDrfNLS13p5cJYUu13LJbeLYS9MQZSZq7PRsg8DsG1oVeDmJbQM9CaVKs9REMnTiRbzye3mDnsQQRRr63BnU/IMDJrmO54ZenkQIbtEkFOX6vm2gtmf/s8C0lPvQk/cNXgkHx6fTq3sZs7pUiFvspj/CrZTx4ShhFNkyvv6RrUu728HspGZwseoZqC7ZbIqnsMqjPeG65qLl+IRYk4s8yT6JBYjYxX96LoHf9V8v0Qbjq4LJm7UpaqX4EJscDRGPByVZaiAwntCU3uzc/NAlgyZJN14yzwXfv1kQUJFLDGYNBF+z0dqON+0DfuCTR
	# Right security gateway, subnet behind it, next hop toward left.
	right=192.1.2.23
	rightid=@east
	rightrsasigkey=0sAQPHTiDA1kGw6ENPkwo2ivTZq3OmSVurjVkLkhKwVJ4pwA1DrK7zMvyvAza6WnRP6TYURI2W3KoSQVg65LbXGigLXeixOLmXepHRd/3ILbanoeKB0sw64Bq7Zv0rm2NS/AHiD7NlXqmvjCpwo/3fiVR+pHYBIrqD3sVoZYQ95yER2Q0WAyjTugeWg8SBkMFz3sBFuNbtFxaFtVf6kenYE2fP6ByQSXPKt0mJFx/tlpCdTudipJMIsk8WxMpd0GTydw5RBVtP0Kfp41wiUrEAgKo4Eu8VOtXkWfdtujSRc+Jm/92ctbEylUlTrinC+QQDohKEqGvOhs9L+LnQNYnDdqsx+y+PddmpEEfQybY0T8c+ogSL
	rightnexthop=192.1.2.254

conn north-east-x509-fail-base
        left=192.1.3.33
        leftrsasigkey=%cert
        # 
        right=192.1.2.23
        rightrsasigkey=%cert

